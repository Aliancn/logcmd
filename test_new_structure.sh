#!/bin/bash
# 测试新的统一配置目录结构

cd /Users/aliancn/code/logcmd

echo "=========================================="
echo "测试1: 查看新的目录结构"
echo "=========================================="
tree ~/.logcmd/ -L 2
echo ""

echo "=========================================="
echo "测试2: 查看数据库位置"
echo "=========================================="
ls -lh ~/.logcmd/data/
echo ""

echo "=========================================="
echo "测试3: 查看配置文件位置"
echo "=========================================="
ls -lh ~/.logcmd/config/
echo ""

echo "=========================================="
echo "测试4: 查看当前模板配置"
echo "=========================================="
cat ~/.logcmd/config/template.json
echo ""

echo "=========================================="
echo "测试5: 执行命令测试"
echo "=========================================="
./bin/logcmd echo "目录结构测试"
echo ""

echo "=========================================="
echo "测试6: 查看项目列表"
echo "=========================================="
./bin/logcmd project list
echo ""

echo "=========================================="
echo "测试7: 修改模板配置"
echo "=========================================="
cat > ~/.logcmd/config/template.json <<'EOF'
{
  "separator": "_",
  "elements": [
    {
      "type": "custom",
      "config": {
        "text": "新配置"
      }
    },
    {
      "type": "command",
      "config": {}
    },
    {
      "type": "time",
      "config": {
        "format": "1504"
      }
    }
  ]
}
EOF
cat ~/.logcmd/config/template.json
echo ""

echo "=========================================="
echo "测试8: 使用新模板执行命令"
echo "=========================================="
./bin/logcmd ls
echo ""

echo "=========================================="
echo "测试9: 查看生成的日志文件"
echo "=========================================="
ls -lh .logcmd/$(date +%Y-%m-%d)/ | tail -5
echo ""

echo "=========================================="
echo "测试10: 验证所有文件都在~/.logcmd目录下"
echo "=========================================="
echo "数据库文件:"
file ~/.logcmd/data/registry.db
echo ""
echo "配置文件:"
file ~/.logcmd/config/template.json
echo ""

echo "=========================================="
echo "测试完成！新的目录结构工作正常 ✓"
echo "=========================================="
