# LogCmd 代码优化与技术债 (TODO)

本列表记录了在代码审查中发现的冗余点、不规范项及潜在的技术优化方向。

## 安全性增强 (Security)
- [ ] **命令执行白名单/校验**
  - **现状**: 目前仅通过 `exec.CommandContext` 执行命令，未对可执行文件进行限制。
  - **目标**: 增加可选的白名单机制或配置项，限制允许通过 `logcmd` 运行的命令，防止恶意命令执行。
- [ ] **文件名清洗逻辑增强**
  - **现状**: `sanitizeFilename` 仅处理了基础非法字符。
  - **目标**: 增强过滤逻辑，处理操作系统保留字（如 Windows 的 `CON`, `PRN`, `NUL`）及文件名长度限制。

## 架构规范性提升 (Architecture)
- [ ] **异步持久化**
  - **现状**: `internal/logger/logger.go` 中，`RecordRun` 和 `UpdateProjectStats` 在命令执行后同步调用。
  - **目标**: 将数据库写操作移至后台 Goroutine 或任务队列中执行，避免数据库延迟影响 CLI 命令的退出速度。

## 性能优化 (Performance)
- [ ] **优化日志文件唯一性检查**
  - **现状**: `ensureUniqueLogPath` 使用线性轮询（最多 10000 次 `os.Stat`）来解决文件名冲突。
  - **目标**: 引入高精度时间戳（毫秒/纳秒）或 UUID 后缀生成文件名，减少或消除 IO 轮询开销。
- [ ] **可配置的日志刷新间隔**
  - **现状**: `internal/logger/logger.go` 中 `syncedWriter` 硬编码了 200ms 的刷新间隔。
  - **目标**: 将刷新间隔暴露为配置项，允许在高吞吐场景下增大间隔以提升性能。
- [ ] **数据库批量写入**
  - **现状**: 每次命令执行都触发独立的 SQL 事务。
  - **目标**: 对于高频执行场景（如脚本循环调用），考虑引入批量写入或缓冲机制。

## 代码质量 (Code Quality)
- [ ] **SQL 语句常量化/规范化**
  - **现状**: SQL 字符串硬编码在 `internal/tasks/manager.go` 的方法体中。
  - **目标**: 将 SQL 语句提取为常量，提升可读性并便于维护。
- [ ] **包命名复核**
  - **现状**: `internal/model` 命名较为通用。
  - **目标**: 考虑根据领域逻辑重新命名（如 `entity` 或按模块划分子包）。
